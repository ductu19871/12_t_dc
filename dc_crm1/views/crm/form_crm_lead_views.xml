<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="crm_case_form_view_oppor" model="ir.ui.view">
        <field name="name">dc.crm1.crm_case_form_view_oppor.form.inherit</field>
        <field name="model">crm.lead</field>
        <field name="inherit_id" ref="sale_crm.crm_case_form_view_oppor" />
        <field name="arch" type="xml">
            <!-- <field name="stage_id" widget="statusbar" options="{'clickable': '1', 'fold_field':
            'fold'}" domain="['|', ('team_id', '=', team_id), ('team_id', '=', False)]"
            attrs="{'invisible': [('active', '=', False)]}"/> -->
            <field name="stage_id" position="attributes">
                <!-- <attribute name="attrs">{'readonly':[('order_line','!=',[])]}</attribute> -->
                <!-- <attribute name="attrs">{'invisible': [('active', '=',
                False)],'readonly':[('type2','=','parent')]}</attribute> -->
                <attribute name="attrs">{'invisible': [('probability', '&gt;', 0)],
                    'readonly':[('order_line','!=',[])]}</attribute>
            </field>
            <!-- <xpath expr="//button[@name='%(sale_crm.sale_action_quotations)d']/div"
            position="replace" >
                <div class="o_field_widget o_stat_info">
                    <span class="o_stat_value"><field name="quotation_amount_total" widget="monetary"
            options="{'currency_field': 'company_currency'}"/></span>
                    <field name="sale_number" class="o_stat_value"/>
                    <span class="o_stat_text"> Quotation(s)</span>
                </div>
            </xpath>

            <xpath expr="//field[@name='sale_amount_total']" position="after" >
                (<field name="confirmed_sale_number" class="o_stat_value"/>)
            </xpath> -->

            <xpath expr="//button[@name='%(sale_crm.sale_action_quotations_new)d']"
                position="replace" />
            <button position="after">
                <button name="%(crm.action_crm_lead2opportunity_partner)d"
                    string="Chuyển thành cơ hội" type="action"
                    help="Convert to Opportunity" class="oe_highlight"
                    attrs="{'invisible': [('type', '=', 'opportunity')]}" />
                <!-- <button name="create_sale_wizard" string="Tạo báo giá/đơn hàng" type="object"
                    attrs="{'invisible': [('probability', '=', 0)]}"
                    class="oe_highlight" /> -->
                <button name="create_sale_wizard" string="Tạo báo giá/đơn hàng" type="object"
                    class="oe_highlight" />
            </button>
            <!-- <field name="name" position="attributes">
                <attribute
            name="readonly">0</attribute>
            </field> -->
            <!-- <xpath expr="//label[@for='email_from']" position="attributes">
                <attribute name="attrs">{'invisible':[('type','=','lead')]}</attribute>
            </xpath> -->
            <!-- <field name="partner_id" position="attributes">
                <attribute
            name="attrs">{'invisible':[('type','=','lead')]}</attribute>
            </field> -->

            <!-- <field name="partner_id" position="before">
                <field name="a1" />
                <field name="b1" />

            </field> -->


            <!-- <xpath expr="//div[@label='email_from']" position="replace" /> -->
            <field name="email_from" position="replace">
            </field>
            <field name="partner_address_phone" position="replace">
                <field name="partner_address_phone" invisible="1" />
            </field>

            <field name="mobile" position="before">
                <field name="phone" />
            </field>
            <xpath expr="//group[1]/group[1]" position="after">
                <!-- <group>
                    <field name="partner_id" widget="res_partner_many2one" string="Customer" domain="[('customer', '=',
                True)]" context="{'search_default_customer': 1,                                         'default_name': partner_name,
                'default_street': street,                                         'default_street2': street2, 'default_city': city,
                'default_state_id': state_id, 'default_zip': zip,                                         'default_country_id': country_id,
                'default_function': function,                                         'default_phone': phone, 'default_mobile': mobile,
                'default_email': email_from,                                         'default_user_id': user_id, 'default_team_id': team_id,
                'default_website': website,                                         'show_vat': True,                                     }"/>
                    <field name="is_blacklisted" invisible="1"/>
                    <field name="partner_is_blacklisted" invisible="1"/>
                    <label for="email_from" class="oe_inline"/>
                    <div class="o_row o_row_readonly">
                        <i class="fa fa-ban" style="color: red;" role="img" title="This email is blacklisted for mass
                mailing" aria-label="Blacklisted" attrs="{'invisible': ['|', ('is_blacklisted', '=',
                False), ('partner_address_email', '!=', False)]}" groups="base.group_user"/>
                        <field name="email_from" attrs="{'invisible': [('partner_address_email', '!=', False)]}"
                string="Email" widget="email"/>
                        <i class="fa fa-ban" style="color: red;" role="img" title="This email is blacklisted for mass
                mailing" aria-label="Blacklisted" attrs="{'invisible': ['|',
                ('partner_is_blacklisted', '=', False), ('partner_address_email', '=', False)]}"
                groups="base.group_user"/>
                        <field name="partner_address_email" attrs="{'invisible': [('partner_address_email', '==', False)]}"
                widget="email" string="Email"/>
                    </div>
                    <field name="partner_address_phone" attrs="{'invisible': [('partner_address_phone', '==', False)]}"
                readonly="1" widget="phone" string="Phone"/>
                    <field name="phone" attrs="{'invisible': [('partner_address_phone', '!=', False)]}"
                widget="phone"/>
                </group> -->
                <group></group>
                <group>
                    <field name="note" attrs="{'invisible':[('type2','=','parent')]}" />
                    <field name="product_id" attrs="{'invisible':[('type2','=','parent')]}" />
                    <field name="categ_id" attrs="{'invisible':[('type2','=','parent')]}" />
                    <field name="select_categ_id" attrs="{'invisible':[('type2','=','parent')]}" />
                    <field name="qty_remain" />
                    <field name="quotation_qty_remain" />
                    <field name="product_uom_qty" attrs="{'invisible':[('type2','=','parent')]}" />
                    <field name="qty_done" />
                    <field name="quotation_qty_done" />
                    <label for="qty_rate" />
                    <div class="o_row d-flex">
                        <field name="qty_rate" widget="integer" class="oe_inline" />
                        <span> %</span>
                    </div>
                    <field name="product_uom" attrs="{'invisible':[('type2','=','parent')]}" />
                    <!-- <field name="price_unit" attrs="{'invisible':[('type2','=','parent')]}"/>
                    <field name="so_price_unit" attrs="{'invisible':[('type2','=','parent')]}"/>
                    <field name="tax_id" readonly="0" widget="many2many_tags"
                    attrs="{'invisible':[('type2','=','parent')]}" />
                    <field name="discount" groups="sale.group_discount_per_so_line"
                    attrs="{'invisible':[('type2','=','parent')]}"/>
                    <field name="price_subtotal" widget="monetary" attrs="{'invisible':[('type2','=','parent')]}"/>
                    <field name="price_total" widget="monetary" />
                    <field name="so_price_total" widget="monetary" />
                    <label for="value_rate" />
                    <div class="o_row d-flex">
                        <field name="value_rate" widget="integer" class="oe_inline" />
                        <span> %</span>
                    </div>         -->


                    <!-- <field name="product_uom_qty"
                    attrs="{'readonly':[('order_line','!=',[])]}"/>
                    <field name="qty_done" />
                    <label for="qty_rate" />
                    <div class="o_row d-flex">
                        <field name="qty_rate" widget="integer" class="oe_inline" />
                        <span> %</span>
                    </div>
                    <field name="price_total" />
                    <field name="so_price_total" />
                    <label for="value_rate" />
                    <div class="o_row d-flex">
                        <field name="value_rate" widget="integer" class="oe_inline" />
                        <span> %</span>
                    </div> -->
                    <!-- <field name="currency_id" />
                    <field name="company_id" /> -->
                </group>
            </xpath>
            <xpath expr="//group/group[4]" position="after">
                <!-- <group>
                    <field name="partner_name" string="Company Name" />
                    <div class="o_address_format oe_edit_only">
                        <field name="country_id" />
                        <field name="state_id" placeholder="State"
                                options="{'no_open': True}"
                                context="{'country_id': country_id, 'zip': zip}" />
                    
                        <div class="o_row">
                            <field name="district_id" placeholder="District"
                                domain="[('state_id','=',state_id)]"
                                options="{'no_create_edit': True}" />
                            <field name="ward_id" placeholder="Ward"
                                domain="[('district_id','=',district_id)]"
                                options="{'no_create_edit': True}" />
                        </div>
                        <div class="o_row">
                            <span class="oe_edit_only">Số nhà</span>
                            <field name="house" />
                            <span class="oe_edit_only">Đường</span>
                            <field name="door" />
                        </div>
                    </div>
                    <field name="address2" placeholder="Address" />
                    <field name="website" widget="url" placeholder="e.g. https://www.odoo.com" />
                </group> -->
                <group>
                    <field name="partner_name" string="Tên Công ty" />
                    <field name="partner_parent_id" />
                    <field name="is_create_partner_parent_id" attrs="{'invisible':[('partner_parent_id','!=',False)]}"/>
                    <label for="street" string="Địa chỉ" class="oe_edit_only" />
                    <div class="o_address_format oe_edit_only" >
                        <!-- <field name="street" placeholder="Địa chỉ..." class="o_address_street" invisible="1" modifiers="{'invisible':true}"/>
                        <field name="street2" placeholder="Địa chỉ, đường..." class="o_address_street" invisible="1" on_change="1" modifiers="{'invisible':true}"/>
                        <field name="city" placeholder="Thành phố" class="o_address_city" invisible="1" modifiers="{'invisible':true}"/>
                        <field name="country_id" on_change="1" can_create="false" can_write="false" /> -->
                        <field name="country_id" />
                        <field name="state_id" placeholder="State"
                                options="{'no_open': True}"
                                context="{'country_id': country_id, 'zip': zip}" />
                        <div class="o_row" >
                            <field name="district_id" placeholder="Quận" domain="[('state_id','=',state_id)]" options="{'no_create_edit': True}"  />
                            <field name="ward_id" placeholder="Phường" domain="[('district_id','=',district_id)]" options="{'no_create_edit': True}"  />
                        </div>
                        <div class="o_row" >
                            <span class="oe_edit_only" >
                                Số nhà
                            </span>
                            <field name="house" on_change="1" />
                            <span class="oe_edit_only" >
                                Đường
                            </span>
                            <field name="door" on_change="1" />
                        </div>
                    </div>
                    <field name="address2" placeholder="Địa chỉ"/>
                    <field name="website" widget="url" placeholder="vd: https://www.odoo.com"/>
                </group>

                <group>
                    <label for="contact_name" />
                    <div class="o_row">
                        <field name="contact_name" />
                        <field name="title" placeholder="Title" domain="[]"
                            options="{&quot;no_open&quot;: True}" />
                    </div>
                    <field name="is_blacklisted" invisible="1" />
                    <label for="email_from" class="oe_inline" />
                    <div class="o_row o_row_readonly">
                        <i class="fa fa-ban" style="color: red;" role="img"
                            title="This email is blacklisted for mass mailing"
                            aria-label="Blacklisted"
                            attrs="{'invisible': [('is_blacklisted', '=', False)]}"
                            groups="base.group_user" />
                        <field name="email_from" widget="email" />
                    </div>
                    <field name="function" />
                    <field name="phone" widget="phone" />
                    <field name="mobile" widget="phone" />
                </group>
            </xpath>
            <field name="date_deadline" position="after">
                <field name="type2" />
                <field name="type" />
                <field name="order_id" readonly="1" />
                <field name="probability_id" />
                <field name="win_state" />

                <field name="price_unit" attrs="{'invisible':[('type2','=','parent')]}" />
                <field name="so_price_unit" attrs="{'invisible':[('type2','=','parent')]}" />
                <field name="tax_id" readonly="0" widget="many2many_tags"
                    attrs="{'invisible':[('type2','=','parent')]}" />
                <field name="discount" groups="sale.group_discount_per_so_line"
                    attrs="{'invisible':[('type2','=','parent')]}" />
                <field name="price_subtotal" widget="monetary"
                    attrs="{'invisible':[('type2','=','parent')]}" />
                <field name="price_total" widget="monetary" />
                <field name="so_price_total" widget="monetary" />
                <label for="value_rate" />
                <div class="o_row d-flex">
                    <field name="value_rate" widget="integer" class="oe_inline" />
                    <span> %</span>
                </div>


            </field>
            <field name="tag_ids" position="after">
                <field name="company_id" />
                <field name="currency_id" />
                <field name="pricelist_id" />
            </field>
            <xpath expr="//notebook" position="inside">
                <page name="call_history_ids" string="Tất cả cuộc gọi">
                    <field name="call_history_ids" />
                </page>
            </xpath>
            <xpath expr="//notebook" position="inside">
                <page name="sale_order_ids" string="Các đơn hàng">
                    <field name="sale_order_ids" />
                </page>
                <page name="connection_ids" string="Lịch sử xúc tiến" attrs="{'invisible':[('type2','=','parent')]}">
                    <field name="connection_ids" >
                        <tree editable="bottom">
                            <field name="date" />
                            <field name="name" />
                            <field name="create_uid" />
                        </tree>
                    </field>
                </page>
                <page name="parent_connection_ids" string="Lịch sử xúc tiến Cha" attrs="{'invisible':[('type2','!=','parent')]}">
                    <field name="parent_connection_ids">
                        <tree editable="bottom">
                            <!-- <field name="crm_id" domain="[('id','in',parent.order_line)]" /> -->
                            <field name="crm_id" />
                            <field name="date" />
                            <field name="name" />
                            <field name="create_uid" />
                        </tree>
                    </field>
                </page>

                <page string="Sản Phẩm/Nhóm (Con)" name="order_lines"
                    attrs="{'invisible':['|',('product_id','!=',False),('order_id','!=',False)]}">
                    <!-- <page string="Sản Phẩm/Nhóm" name="order_lines" > -->
                    <field name="order_line">
                        <tree string="Sales Order Lines" editable="bottom">
                            <!-- We do not display the type because we don't want the user to be
                            bothered with that information if he has no section or note. -->

                            <field name="name" />
                            <field name="product_id" />
                            <field name="categ_id" />
                            <field name="select_categ_id" />
                            <field name="product_uom_qty" />
                            <field name="qty_done" />
                            <field name="quotation_qty_done" />
                            <field name="qty_remain" />
                            <field name="quotation_qty_remain" />
                            <field name="product_uom" />
                            <field name="price_unit" />
                            <field name="so_price_unit" />
                            <field name="tax_id" readonly="0" widget="many2many_tags" />
                            <field name="discount" groups="sale.group_discount_per_so_line" />
                            <field name="price_subtotal" widget="monetary" />
                            <field name="price_total" widget="monetary" />
                            <field name="so_price_total" widget="monetary" />
                            <field name="currency_id" invisible="1" />
                            <field name="company_id" invisible="1" />
                            <field name="stage_id" />
                            <field name="team_id" />
                            <field name="is_win" invisible="1" />
                            <field name="win_state" />
                        </tree>
                    </field>

                    <group class="oe_subtotal_footer oe_right" colspan="2" name="sale_total">
                        <field name="price_subtotal" widget="monetary"
                            options="{'currency_field': 'currency_id'}" />
                        <field name="price_tax" widget="monetary"
                            options="{'currency_field': 'currency_id'}" />
                        <div class="oe_subtotal_footer_separator oe_inline o_td_label">
                            <label for="price_total" />
                        </div>
                        <field name="price_total" nolabel="1" class="oe_subtotal_footer_separator"
                            widget="monetary" options="{'currency_field': 'currency_id'}" />
                    </group>
                </page>
                <!-- <page string="Sản Phẩm/Nhóm (Đơn)" >
                    <group>
                            <field name="product_id" />
                            <field name="categ_id" />
                            <field name="select_categ_id" />
                            <field name="qty_done" />
                            <field name="qty_remain" />
                            <field name="product_uom_qty" attrs="{'readonly':[('order_line','!=',[])]}"/>
                            <field name="product_uom" />
                            <field name="price_unit" />
                            <field name="so_price_unit" />
                            <field name="tax_id" readonly="0" widget="many2many_tags" />
                            <field name="discount" groups="sale.group_discount_per_so_line" />
                            <field name="price_subtotal" widget="monetary" />
                            <field name="price_total" widget="monetary" />
                            <field name="so_price_total" widget="monetary" />
              
                            <field name="currency_id" />
                            <field name="company_id" />
                            <field name="team_id" />
                            <field name="is_win" />
                            <field name="win_state" />
                    </group>
                   
                </page> -->
            </xpath>
        </field>
    </record>

    <record model="ir.actions.act_window" id="crm.crm_lead_opportunities_tree_view">
        <!-- <field name="name">Pipeline</field> -->
        <!-- <field name="res_model">crm.lead</field> -->
        <!-- <field name="view_mode">kanban,tree,graph,pivot,form,calendar,activity</field> -->
        <field name="domain">[]</field>
        <!-- <field name="context">{
                'default_type': 'opportunity',
                'search_default_assigned_to_me': 1
        }</field>
        <field name="search_view_id" ref="crm.view_crm_case_opportunities_filter"/> -->
    </record>


</odoo>